---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

let posts = [];
try {
  posts = (await getCollection("blog"))
    .sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime());
} catch (e) {
  posts = [];
}

function formatDate(date: Date) {
  const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
  const day = date.getDate();
  const month = months[date.getMonth()];
  const year = date.getFullYear();
  return `${month} ${day}, ${year}`;
}
---

<BaseLayout title="Efe Güçlü — Blog" description="Security notes and OverTheWire write-ups by Efe Güçlü.">
  <div class="page">
    <h1>Blog</h1>
    <p class="desc">Notes on security, Linux, cloud, and OverTheWire write-ups.</p>

    {posts.length === 0 ? (
      <p class="empty">No posts yet.</p>
    ) : (
      <div class="posts">
        {posts.map((post) => (
          <a href={`/blog/${post.slug}/`} class="post">
            <h2>{post.data.title}</h2>
            <span class="date">{formatDate(post.data.pubDate)}</span>
            <p>{post.data.description}</p>
          </a>
        ))}
      </div>
    )}
  </div>

  <style>
    .page {
      padding: 20px 0;
    }

    h1 {
      margin-bottom: 12px;
    }

    .desc {
      color: var(--color-text-muted);
      margin-bottom: 32px;
    }

    .posts {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .post {
      display: block;
      padding: 20px;
      border: 1px solid var(--color-border);
      border-radius: 6px;
      background: var(--color-bg-card);
      text-decoration: none;
      transition: border-color var(--transition-fast);
    }

    .post:hover {
      border-color: var(--color-border-hover);
    }

    .post h2 {
      font-size: 1rem;
      color: var(--color-accent);
      margin: 0 0 8px;
    }

    .post:hover h2 {
      color: var(--color-accent-hover);
    }

    .date {
      font-size: 0.85rem;
      color: var(--color-text-subtle);
    }

    .post p {
      margin: 12px 0 0;
      color: var(--color-text-muted);
      line-height: 1.6;
    }

    .empty {
      color: var(--color-text-subtle);
    }
  </style>
</BaseLayout>
